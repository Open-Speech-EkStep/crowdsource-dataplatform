$(document).ready(function(){const e=$("#proceed-box"),t=e.parent(),a=document.querySelectorAll('input[name = "gender"]'),n=document.getElementById("age"),o=document.getElementById("mother-tongue"),r=$("#username"),s=r.next(),d=$("#tnc");let l="Odia";const c=e=>{testUserName(e)?t.attr("data-original-title","Please validate any error message before proceeding"):t.attr("data-original-title","Please agree to the Terms and Conditions before proceeding")};setUserNameTooltip(r);const i=()=>{const e=r.val().trim();testUserName(e)?(r.addClass("is-invalid"),s.removeClass("d-none")):(r.removeClass("is-invalid"),s.addClass("d-none")),d.trigger("change"),setUserNameTooltip(r)};r.tooltip({container:"body",placement:screen.availWidth>500?"right":"auto",trigger:"focus"}),d.prop("checked",!1),t.tooltip({container:"body",placement:screen.availWidth>500?"right":"auto"});let u;(()=>{const e=localStorage.getItem("speakerDetails");if(e){const t=JSON.parse(e),a=document.querySelector('input[name = "gender"][value="'+t.gender+'"]');a&&(a.checked=!0,a.previous=!0),n.value=t.age,o.value=t.motherTongue,r.val(t.userName?t.userName.trim().substring(0,12):""),i()}})(),a.forEach(e=>{e.addEventListener("click",e=>{e.target.previous&&(e.target.checked=!1),e.target.previous=e.target.checked})}),document.getElementById("languageTop").addEventListener("change",e=>{u=e.target.value,$("#start_recording").removeAttr("disabled")}),document.getElementById("start_recording").addEventListener("click",()=>{l=u});let g="Odia";document.getElementById("language").addEventListener("change",e=>{updateLanguage(g=e.target.value,fetchDetail),updateLanguageInButton(g),updateGraph(g)}),document.getElementById("start-record").addEventListener("click",()=>{l=g}),c(r.val().trim()),d.change(function(){const a=r.val().trim();this.checked&&!testUserName(a)?(e.removeAttr("disabled").removeClass("point-none"),t.tooltip("disable")):(c(a),e.prop("disabled","true").addClass("point-none"),t.tooltip("enable"))}),r.on("input focus",i),e.on("click",()=>{if(d.prop("checked")){const e=Array.from(a).filter(e=>e.checked),t=e.length?e[0].value:"",s=r.val().trim().substring(0,12);if(testUserName(s))return;const d={gender:t,age:n.value,motherTongue:o.value,userName:s,language:l};localStorage.setItem("speakerDetails",JSON.stringify(d)),location.href="/record"}}),$("#userModal").on("shown.bs.modal",function(){document.getElementById("resetBtn").addEventListener("click",()=>{const e=document.querySelector('input[name = "gender"]:checked');e&&(e.checked=!1),n.selectedIndex=0,o.selectedIndex=0,r[0].value=""})}),updateLanguageInButton("Odia"),updateLanguage("Odia",fetchDetail)});const testUserName=e=>{return/^[6-9]\d{9}$/.test(e)||/^\S+@\S+[\.][0-9a-z]+$/.test(e)};function setUserNameTooltip(e){e.val().length>11?(e.tooltip("enable"),e.tooltip("show")):(e.tooltip("disable"),e.tooltip("hide"))}function updateLanguageInButton(e){document.getElementById("start-record").innerText=`START RECORDING IN ${e.toUpperCase()}`}function calculateTime(e){const t=6*e,a=t%3600;return{hours:Math.floor(t/3600),minutes:Math.floor(a/60),seconds:a%60}}const fetchDetail=e=>fetch(`/getDetails/${e}`).then(e=>{if(e.ok)return Promise.resolve(e.json());throw Error(e.statusText||"HTTP error")});function updateLanguage(e,t){const a=$("#speaker-data").find("#loader1,#loader2"),n=$("#speakers-wrapper"),o=$("#speaker-value"),r=$("#hours-wrapper"),s=$("#hour-value");return a.removeClass("d-none"),r.addClass("d-none"),n.addClass("d-none"),t(e).then(e=>{try{const t=e.find(e=>1===e.index).count,{hours:d,minutes:l,seconds:c}=calculateTime(t);return s.text(`${d}h ${l}m ${c}s`),o.text(e.find(e=>0===e.index).count),a.addClass("d-none"),r.removeClass("d-none"),n.removeClass("d-none"),localStorage.setItem("speakersData",JSON.stringify(e)),Promise.resolve(!0)}catch(e){return console.log(e),Promise.reject(e)}}).catch(e=>(console.log(e),Promise.reject(e)))}module.exports={updateLanguageInButton:updateLanguageInButton,updateLanguage:updateLanguage,calculateTime:calculateTime,testUserName:testUserName};
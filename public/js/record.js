!function e(o,n,t){function a(s,d){if(!n[s]){if(!o[s]){var i="function"==typeof require&&require;if(!d&&i)return i(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=n[s]={exports:{}};o[s][0].call(c.exports,function(e){var n=o[s][1][e];return a(n||e)},c,c.exports,e,o,n,t)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<t.length;s++)a(t[s]);return a}({1:[function(e,o,n){"use strict";var t="speakerDetails",a="currentIndex",r="skipCount",s=function(){var e=crowdSource.sentences,o=document.getElementById("currentSentenceLbl"),n=document.getElementById("totalSentencesLbl"),s=document.getElementById("sentenceLbl"),d=$("#sentenceLbl"),i=$("#time-progress"),c=$("#time-value"),l=$("#graphbar"),u=$("#startRecord"),m=$("#startRecordRow"),g=$("#stopRecord"),f=$("#reRecord"),p=$("#visualizer"),h=$("#player"),v=$("#nextBtn"),C=v.parent(),w=$("#get-started"),b=$("#skipBtn"),S=$("#recording-row"),y=$("#recording-sign"),x=$(".progress-bar"),I=$("#page-content"),N=$("#audio-small-error"),k=Number(localStorage.getItem(a)),T=Number(localStorage.getItem(r)),B=e.length,R=k<0?0:k>B-1?B-1:k,A=T<0?0:T>B-1?B-1:T,D=$("footer"),L=["Letâ€™s get started","","We know you can do more! ","","","You are halfway there. Keep going!","","Just few more steps to go!","","Nine dead, one more to go!","Yay! Done & Dusted!"];C.tooltip({container:"body",placement:screen.availWidth>900?"right":"bottom"});var O,q,M,W,E,J,U,j,P=function(e,o,n){e.addClass("animated ".concat(o)),e.on("animationend",function(){e.removeClass("animated ".concat(o)),e.off("animationend"),"function"==typeof n&&n()})},z=function(e){x.width(10*e+"%"),x.prop("aria-valuenow",e)},Y=function(o){s.innerText=e[o].sentence,P(d,"lightSpeedIn"),R&&z(R)},F=function(e){return o.innerText=e},H=function(e){var o=6*(crowdSource.count+e-A),n=o>=1800,t=n?o:1800-o,a=Math.floor(t/60),r=t%60;c.text("".concat(a,"m ").concat(r,"s")),n&&c.siblings("p").text("We are loving it!");var s=42/1800*o;l.height(s+"em")},K=new Notyf({position:{x:"center",y:"top"},types:[{type:"success",className:"fnt-1-5"},{type:"error",duration:3500,className:"fnt-1-5"}]});O=D.outerHeight(),q=i.css("bottom"),Number(q.substring(0,q.length-2))&&i.css("bottom",O+"px"),Y(R),F(R+1),M=B,n.innerText=M,H(R),u.add(f).on("click",function(){navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(e){w.hide(),m.addClass("d-none"),g.removeClass("d-none"),S.removeClass("d-none"),y.removeClass("d-none"),f.addClass("d-none"),v.addClass("d-none"),h.addClass("d-none"),h.trigger("pause"),p.removeClass("d-none"),C.tooltip("disable"),N.addClass("d-none"),W=e;var o=window.AudioContext||window.webkitAudioContext;j&&j.close();var n=(j=new o).createAnalyser();(J=j.createMediaStreamSource(e)).connect(n),function(e,o){var n=e.getContext("2d"),t=o.frequencyBinCount,a=new Uint8Array(t),r=e.width,s=e.height;!function d(){requestAnimationFrame(d);o.getByteTimeDomainData(a);n.fillStyle="rgb(255, 255, 255, 0.8)";n.fillRect(0,0,r,s);n.lineWidth=2;n.strokeStyle="rgb(0,123,255)";n.beginPath();var i=1*r/t;var c=0;for(var l=0;l<t;l++){var u=a[l]/128,m=u*s/2;0===l?n.moveTo(c,m):n.lineTo(c,m),c+=i}n.lineTo(e.width,e.height/2);n.stroke()}()}(visualizer,n),(E=new Recorder(J,{numChannels:2})).record(),U=setTimeout(function(){g.click()},3e4)}).catch(function(e){console.log(e),K.error("Sorry !!! We could not get access to your audio input device. Make sure you have given microphone access permission"),m.removeClass("d-none"),g.addClass("d-none"),v.addClass("d-none"),f.addClass("d-none"),y.addClass("d-none"),S.addClass("d-none"),h.addClass("d-none"),h.trigger("pause"),p.addClass("d-none"),N.addClass("d-none")})}),g.on("click",function(){clearTimeout(U),g.addClass("d-none"),v.removeClass("d-none"),f.removeClass("d-none"),y.addClass("d-none"),S.addClass("d-none"),m.addClass("d-none"),h.removeClass("d-none"),p.addClass("d-none"),E.stop(),W.getAudioTracks()[0].stop(),E.exportWAV(function(e){var o=(window.URL||window.webkitURL).createObjectURL(e);crowdSource.audioBlob=e,h.prop("src",o),h.on("loadedmetadata",function(){var e=h[0].duration;e<2?(C.tooltip("enable"),v.prop("disabled",!0).addClass("point-none"),N.removeClass("d-none")):(C.tooltip("disable"),v.removeAttr("disabled").removeClass("point-none"),N.addClass("d-none"))})}),R==B-1&&w.text(L[B]).show()});var V=function(){location.href="/thank-you"};function _(e){var o=new FormData;o.append("audio_data",crowdSource.audioBlob),o.append("speakerDetails",localStorage.getItem(t)),o.append("sentenceId",crowdSource.sentences[R].sentenceId),fetch("/upload",{method:"POST",body:o}).then(function(e){return e.json()}).then(function(e){}).catch(function(e){console.log(e)}).then(function(o){e&&"function"==typeof e&&e()})}v.add(b).on("click",function(e){"nextBtn"===e.target.id&&R<B-1?(_(),H(R+1)):"skipBtn"===e.target.id&&(A++,localStorage.setItem(r,A),b.addClass("d-none")),R==B-1?("nextBtn"===e.target.id?_(V):setTimeout(V,2500),b.addClass("d-none"),D.addClass("fixed-bottom"),R++,P(I,"zoomOut",function(){return I.addClass("d-none")}),z(R),localStorage.removeItem("sentences"),localStorage.setItem(a,R),K.success("Congratulations!!! You have completed this batch of sentences"),$("#loader").show()):R<B-1&&(Y(++R),F(R+1),w.text(L[R]),localStorage.setItem(a,R),b.removeClass("d-none")),h.addClass("d-none"),h.trigger("pause"),v.addClass("d-none"),f.addClass("d-none"),m.removeClass("d-none")})};$(document).ready(function(){var e=$("footer");window.crowdSource={};var o=$("#instructionsModal"),n=$("#errorModal"),d=$("#loader"),i=$("#page-content"),c=$("#nav-user"),l=c.find("#nav-username");try{var u=localStorage.getItem(t),m=JSON.parse(u),g=localStorage.getItem("sentences"),f=JSON.parse(g),p=Number(localStorage.getItem("count"));if(o.on("hidden.bs.modal",function(){i.removeClass("d-none"),e.removeClass("fixed-bottom"),e.addClass("bottom")}),n.on("show.bs.modal",function(){o.modal("hide")}),n.on("hidden.bs.modal",function(){location.href="/#speaker-details"}),!m)return void(location.href="/#speaker-details");m.userName&&(c.removeClass("d-none"),l.text(m.userName)),f&&f.userName===m.userName&&f.language===m.language?(crowdSource.sentences=f.sentences,crowdSource.count=p,d.hide(),i.removeClass("d-none"),s()):(localStorage.removeItem(a),localStorage.removeItem(r),fetch("/sentences",{method:"POST",body:JSON.stringify({userName:m.userName,age:m.age,language:m.language}),headers:{"Content-Type":"application/json"}}).then(function(e){if(e.ok)return e.json();throw Error(e.statusText||"HTTP error")}).then(function(e){o.modal("show"),crowdSource.sentences=e.data,crowdSource.count=Number(e.count),d.hide(),s(),localStorage.setItem("sentences",JSON.stringify({userName:m.userName,sentences:e.data})),localStorage.setItem("count",e.count)}).catch(function(e){console.log(e),n.modal("show")}).then(function(){d.hide()}))}catch(e){console.log(e),n.modal("show")}})},{}]},{},[1]);